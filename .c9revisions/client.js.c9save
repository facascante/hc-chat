{"ts":1362824136426,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1362829455269,"patch":[[{"diffs":[[1,"module.exports = {\n    \n    getRoom : function(client,gender,fn){\n        client.smembers('hc:rooms',function(err, rooms){\n            if(err){\n                fn(err);\n            }\n            else if(rooms.length > 0){\n                var i=0;\n                rooms.forEach(function(room){\n                    var roomInfo = JSON.stringify(room);\n                    if(roomInfo.visitor.length == 0){\n                        fn(null,roomInfo); return;\n                    }\n                    if(roomInfo.visitor.length == 1 &&  (roomInfo.visitor[0].gender != gender)){\n                        fn(null,roomInfo); return;\n                    }\n                    i++;\n                });\n                if(i == rooms.length){\n                    fn(null,{no:i++,visitor:[]});\n                }\n            }\n            else{\n                fn(null,{no:1,visitor:[]});\n            }\n        });\n    }\n}"]],"start1":0,"start2":0,"length1":0,"length2":908}]],"length":908,"saved":false}
{"ts":1362830710433,"patch":[[{"diffs":[[0,"        });\n"],[1,"    },\n    addVisitor : function(client,room,visitor,fn){\n        client.srem('hc:rooms',room);\n        room.visitor.push(visitor);\n        client.sadd(room);\n"],[0,"    }\n}"]],"start1":1100,"start2":1100,"length1":19,"length2":178}]],"length":1278,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362833971006,"patch":[[{"diffs":[[0,"gify(room);\n"],[1,"                    /*** is room empty ***/\n"],[0,"            "]],"start1":338,"start2":338,"length1":24,"length2":68},{"diffs":[[0,"              }\n"],[1,"                    /*** is room contain 1 visitor and gender is opposite ***/\n"],[0,"                "]],"start1":505,"start2":505,"length1":32,"length2":111},{"diffs":[[0,"        });\n"],[1,"                /*** no more vacant room ***/\n"],[0,"            "]],"start1":803,"start2":803,"length1":24,"length2":70},{"diffs":[[0,"}\n            }\n"],[1,"            /*** no room created yet ***/\n"],[0,"            else"]],"start1":966,"start2":966,"length1":32,"length2":74},{"diffs":[[0,",visitor"],[-1,",fn"],[0,""],[1,""],[0,"){\n     "]],"start1":1156,"start2":1156,"length1":19,"length2":16}]],"length":1275,"saved":false}
{"ts":1362834255565,"patch":[[{"diffs":[[0,"(client,"],[-1,"gend"],[1,"us"],[0,"er,fn){\n"]],"start1":46,"start2":46,"length1":20,"length2":18},{"diffs":[[0,"ength > 0){\n"],[1,"                var isExist = false;\n                rooms.forEach(function(room){\n                    room.visitor.forEach(function(visitor){\n                        if(visitor.username == user.username){\n                            isExist = true;\n                        }\n                    });\n                });\n"],[0,"            "]],"start1":208,"start2":208,"length1":24,"length2":344},{"diffs":[[0,"posite ***/\n"],[-1,""],[0,"            "]],"start1":906,"start2":906,"length1":24,"length2":24},{"diffs":[[0,"nder != "],[1,"user."],[0,"gender))"]],"start1":997,"start2":997,"length1":16,"length2":21}]],"length":1598,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362846205146,"patch":[[{"diffs":[[0,"    "],[-1,"getRoom"],[1,"roomList"],[0," : f"]],"start1":24,"start2":24,"length1":15,"length2":16},{"diffs":[[0,"ent,"],[-1,"user,"],[0,"fn){"]],"start1":51,"start2":51,"length1":13,"length2":8},{"diffs":[[0,"else"],[-1," if(rooms.length > 0){\n                var isExist = false;\n                rooms.forEach(function(room){"],[1,"{\n                fn(null,rooms);\n            }"],[0,"\n   "]],"start1":189,"start2":189,"length1":113,"length2":55},{"diffs":[[0,"    "],[-1,"  "],[1,"});"],[0,"  "],[1,"\n"],[0,"    "],[1,"},\n"],[0,"    "],[-1,"room.visitor.forEach(function(visitor){\n                        if(visitor.username == user.username){\n                            isExist = true;\n                        }\n       "],[1,"getRoom : function(client,user,fn){\n        client.smembers('hc:rooms',function(err, rooms){\n            if(err){\n                fn(err);\n"],[0,"    "]],"start1":245,"start2":245,"length1":200,"length2":164},{"diffs":[[0,"r);\n            "],[-1," });"],[1,"}"],[0,"\n               "]],"start1":401,"start2":401,"length1":36,"length2":33},{"diffs":[[0,"  }\n            "],[-1,"    });"],[1,"else if(rooms.length > 0){"],[0,"\n               "]],"start1":415,"start2":415,"length1":39,"length2":58},{"diffs":[[0,"ength =="],[-1,""],[0,""],[1,"="],[0," 0){\n   "]],"start1":671,"start2":671,"length1":16,"length2":17},{"diffs":[[0,"              }\n"],[1,"                    /*** is user already exist ***/\n                    roomInfo.visitor.forEach(function(visitor){\n                        if(visitor.username == user.username){\n                            fn(null,roomInfo); return;\n                           \n                        }\n                    });\n"],[0,"                "]],"start1":742,"start2":742,"length1":32,"length2":344},{"diffs":[[0,",room,visitor){\n"],[1,"        var isUserExist = false;\n        room.visitor.forEach(function(user){\n            if(user.username == visitor.username){\n                isUserExist = true;\n            }\n        });\n        if(!isUserExist){\n    "],[0,"        client.s"]],"start1":1705,"start2":1705,"length1":32,"length2":253},{"diffs":[[0,"oms',room);\n"],[1,"    "],[0,"        room"]],"start1":1968,"start2":1968,"length1":24,"length2":28},{"diffs":[[0,"isitor);"],[1,"    \n        }"],[0,"\n       "]],"start1":2011,"start2":2011,"length1":16,"length2":30}]],"length":2068,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362857496793,"patch":[[{"diffs":[[0,"sadd(room);\n"],[1,"    },\n    removeVisitor : function(client,room,visitor){\n        for(var user in room.visitor){\n            if(room.visitor[user].username == visitor.username){\n                delete room.visitor[user];\n            }\n        }\n"],[0,"    }\n}"]],"start1":2049,"start2":2049,"length1":19,"length2":248}]],"length":2297,"saved":false}
{"ts":1362857660507,"patch":[[{"diffs":[[0,",room,visitor){\n"],[1,"        client.srem('hc:rooms',room);\n"],[0,"        for(var "]],"start1":2103,"start2":2103,"length1":32,"length2":70},{"diffs":[[0,"}\n        }\n"],[1,"        client.sadd(room);\n"],[0,"    }\n}"]],"start1":2316,"start2":2316,"length1":19,"length2":46}]],"length":2362,"saved":false}
{"ts":1362857749219,"patch":[[{"diffs":[[0,",room,visitor){\n"],[1,"        console.log(\"Removing user\");\n        console.log(room);\n        console.log(visitor);\n"],[0,"        client.s"]],"start1":2103,"start2":2103,"length1":32,"length2":127}]],"length":2457,"saved":false}
{"ts":1362857766672,"patch":[[{"diffs":[[0,",room,visitor){\n"],[1,"        console.log(\"Adding user\");\n        console.log(room);\n        console.log(visitor);\n"],[0,"        var isUs"]],"start1":1705,"start2":1705,"length1":32,"length2":125}]],"length":2550,"saved":false}
{"ts":1362857819244,"patch":[[{"diffs":[[0,"t,user,fn){\n"],[1,"        console.log(\"Getting Rooms and Visitor\");\n        console.log(user);\n"],[0,"        clie"]],"start1":290,"start2":290,"length1":24,"length2":101},{"diffs":[[0,"ength > 0){\n"],[1,"                console.log(rooms);\n"],[0,"            "]],"start1":523,"start2":523,"length1":24,"length2":60}]],"length":2663,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362874391166,"patch":[[{"diffs":[[0,"    client.sadd("],[1,"'hc:rooms',"],[0,"room);\n    },\n  "]],"start1":2244,"start2":2244,"length1":32,"length2":43},{"diffs":[[0,"nt.sadd("],[1,"'hc:rooms',"],[0,"room);\n "]],"start1":2652,"start2":2652,"length1":16,"length2":27}]],"length":2685,"saved":false}
{"ts":1362874539702,"patch":[[{"diffs":[[0,"srem('hc:rooms',"],[1,"JSON.stringify("],[0,"room)"],[1,")"],[0,";\n        for(va"]],"start1":2446,"start2":2446,"length1":37,"length2":53},{"diffs":[[0,"('hc:rooms',"],[1,"JSON.stringify("],[0,"room)"],[1,")"],[0,";\n    }\n}"]],"start1":2675,"start2":2675,"length1":26,"length2":42}]],"length":2717,"saved":false}
{"ts":1362874571612,"patch":[[{"diffs":[[0,"('hc:rooms',"],[1,"JSON.stringify("],[0,"room)"],[1,")"],[0,";\n          "]],"start1":2167,"start2":2167,"length1":29,"length2":45},{"diffs":[[0,":rooms',"],[1,"JSON.stringify("],[0,"room)"],[1,")"],[0,";\n    },"]],"start1":2279,"start2":2279,"length1":21,"length2":37}]],"length":2749,"saved":false}
{"ts":1362875074348,"patch":[[{"diffs":[[0,"fn(null,"],[1,"JSON.parse("],[0,"rooms)"],[1,")"],[0,";\n      "]],"start1":211,"start2":211,"length1":22,"length2":34},{"diffs":[[0,"            "],[-1,"console.log"],[1,"rooms = JSON.parse"],[0,"(rooms);\n   "]],"start1":551,"start2":551,"length1":35,"length2":42},{"diffs":[[0,"mInfo = "],[-1,"JSON.stringify("],[0,"room"],[-1,")"],[0,";\n      "]],"start1":688,"start2":688,"length1":36,"length2":20}]],"length":2752,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362876516974,"patch":[[{"diffs":[[0,"ull,"],[-1,"JSON.parse("],[0,"rooms)"],[-1,")"],[0,";\n  "]],"start1":215,"start2":215,"length1":26,"length2":14}]],"length":2740,"saved":false}
{"ts":1362876579039,"patch":[[{"diffs":[[0,"0){\n"],[-1,"                rooms = JSON.parse(rooms);\n"],[0,"    "]],"start1":531,"start2":531,"length1":51,"length2":8},{"diffs":[[0,"mInfo = "],[1,"JSON.parse("],[0,"room"],[1,")"],[0,";\n      "]],"start1":633,"start2":633,"length1":20,"length2":32}]],"length":2709,"saved":false}
{"ts":1362877010738,"patch":[[{"diffs":[[0,"on(err, rooms){\n"],[1,"            console.log(\"Getting Rooms \" + rooms.length);\n"],[0,"            if(e"]],"start1":101,"start2":101,"length1":32,"length2":90},{"diffs":[[0,"\");\n"],[-1,"        console.log(user);\n"],[0,"    "]],"start1":406,"start2":406,"length1":35,"length2":8}]],"length":2740,"saved":false}
{"ts":1362877019114,"patch":[[{"diffs":[[0,"ng Rooms"],[1,":"],[0," \" + roo"]],"start1":147,"start2":147,"length1":16,"length2":17}]],"length":2741,"saved":false}
{"ts":1362877044048,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(\"Getting Rooms and Visitor\");"],[0,"\n   "]],"start1":365,"start2":365,"length1":49,"length2":8},{"diffs":[[0,"on(err, rooms){\n"],[1,"            console.log(\"Getting Rooms and Visitor: \" + rooms.length );\n"],[0,"            if(e"]],"start1":411,"start2":411,"length1":32,"length2":104}]],"length":2772,"saved":false}
{"ts":1362877080820,"patch":[[{"diffs":[[0,"\");\n"],[-1,"        console.log(room);\n        console.log(visitor);\n"],[0,"    "]],"start1":1889,"start2":1889,"length1":65,"length2":8},{"diffs":[[0,"tion(user){\n"],[1,"            \n"],[0,"            "]],"start1":1959,"start2":1959,"length1":24,"length2":37}]],"length":2728,"saved":false}
{"ts":1362877086426,"patch":[[{"diffs":[[0,"\");\n"],[-1,"        console.log(room);\n        console.log(visitor);\n"],[0,"    "]],"start1":2381,"start2":2381,"length1":65,"length2":8}]],"length":2671,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362877925902,"patch":[[{"diffs":[[0,"(user){\n"],[-1,"            \n"],[0,"        "]],"start1":1963,"start2":1963,"length1":29,"length2":16}]],"length":2658,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362880545094,"patch":[[{"diffs":[[0,"ull,{no:"],[-1,"i++"],[1,"(rooms.length + 1)"],[0,",visitor"]],"start1":1614,"start2":1614,"length1":19,"length2":34}]],"length":2673,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362900435837,"patch":[[{"diffs":[[0,"r,fn){\n        \n"],[1,"        \n        /*\n"],[0,"        client.s"]],"start1":354,"start2":354,"length1":32,"length2":52},{"diffs":[[0,"on(err, rooms){\n"],[-1,""],[0,"            cons"]],"start1":431,"start2":431,"length1":32,"length2":32},{"diffs":[[0,"    "],[-1,"      /*** is room empty ***/"],[0,"\n   "]],"start1":752,"start2":752,"length1":37,"length2":8},{"diffs":[[0,"    "],[-1,"   /*** is user already exist ***/"],[0,"\n   "]],"start1":898,"start2":898,"length1":42,"length2":8},{"diffs":[[0,"    "],[-1,"   /*** is room contain 1 visitor and gender is opposite ***/"],[0,"\n   "]],"start1":1176,"start2":1176,"length1":69,"length2":8},{"diffs":[[0,"    "],[-1,"     /*** no more vacant room ***/"],[0,"\n   "]],"start1":1408,"start2":1408,"length1":42,"length2":8},{"diffs":[[0,"    "],[-1,"     /*** no room created yet ***/"],[0,"\n   "]],"start1":1552,"start2":1552,"length1":42,"length2":8},{"diffs":[[0,";\n            }\n"],[-1,""],[0,"        });\n    "]],"start1":1617,"start2":1617,"length1":32,"length2":32},{"diffs":[[0,"        });\n"],[1,"        */\n"],[0,"    },\n    a"]],"start1":1633,"start2":1633,"length1":24,"length2":35}]],"length":2512,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362905499466,"patch":[[{"diffs":[[0,"      \n        \n"],[1,"        client.smembers('hc:rooms',function(err, rooms){\n            var room;\n            if(err){\n                fn(err);\n            }\n            else if(!rooms && (rooms.length == 0)){\n                   room = 1;\n                   client.sadd('hc:rooms',room);\n                   client.sadd('hc:room:'+room+':visitor',user);\n            }\n            else \n            \n        });\n"],[0,"        /*\n     "]],"start1":363,"start2":363,"length1":32,"length2":423}]],"length":2903,"saved":false}
{"ts":1362906482828,"patch":[[{"diffs":[[0,"r);\n            "],[-1,""],[0,""],[1,"    console.log(\"Redis failed!, smembers hc:rooms \"+err);\n            "],[0,"}\n            el"]],"start1":500,"start2":500,"length1":32,"length2":102},{"diffs":[[0,"        "],[-1,"}\n            else "],[1,"       console.log(\"room and visitor added successfully\");\n                   fn(null,room);\n            }\n            else{\n                var ctr = 0;\n            }\n                while (ctr < rooms.length) {\n                    client.smembers('hc:room:'+rooms[ctr]+':visitor',function(err,visitors){\n                        if(err){\n                            console.log(\"Redis failed!, smembers\" + 'hc:room:'+rooms[ctr]+':visitor' +err);\n                            fn(err);\n                        }\n                    });\n                    ctr++;\n                }\n            }"],[0,"\n       "]],"start1":787,"start2":787,"length1":35,"length2":608}]],"length":3546,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362956765584,"patch":[[{"diffs":[[0,"    "],[-1,"getRoom"],[1,"accomodateVisitor"],[0," : f"]],"start1":321,"start2":321,"length1":15,"length2":25},{"diffs":[[0,"(!rooms "],[-1,"&&"],[1,"||"],[0," (rooms."]],"start1":617,"start2":617,"length1":18,"length2":18},{"diffs":[[0," ctr = 0"],[-1,";\n            }"],[1,", ctrin = 0;"],[0,"\n       "]],"start1":949,"start2":949,"length1":31,"length2":28},{"diffs":[[0,"room:'+rooms[ctr"],[1,"in"],[0,"]+':visitor' +er"]],"start1":1213,"start2":1213,"length1":32,"length2":34},{"diffs":[[0,"                "],[-1,"}"],[1,"    break;\n                        }\n                        else if(!visitors || (visitors.length == 0)){\n                            client.sadd('hc:room:'+rooms[ctrin]+':visitor',user);\n                            fn(null,rooms[ctrin]);\n                            break;\n                        }\n                        else if(visitors.length == 1){\n                            visitor = JSON.parse(visitors[0]);\n                            if(visitor.gender != user.gender && visitor.username != user.username){\n                                client.sadd('hc:room:'+rooms[ctrin]+':visitor',user);\n                                fn(null,rooms[ctrin]);\n                                break;\n                            }\n                        }\n                        else{\n                            \n                        }\n                        ctrin++;"],[0,"\n               "]],"start1":1296,"start2":1296,"length1":33,"length2":904}]],"length":4426,"saved":false}
{"ts":1362956774244,"patch":[[{"diffs":[[0,"n){\n        "],[-1,"\n "],[0,"       \n    "]],"start1":367,"start2":367,"length1":26,"length2":24}]],"length":4424,"saved":false}
{"ts":1362957400103,"patch":[[{"diffs":[[0,".gender "],[-1,"&&"],[1,"||"],[0," visitor"]],"start1":1782,"start2":1782,"length1":18,"length2":18}]],"length":4424,"saved":false}
{"ts":1362957453000,"patch":[[{"diffs":[[0,"room+':visitor',"],[1,"JSON.stringify("],[0,"user)"],[1,")"],[0,";\n              "]],"start1":768,"start2":768,"length1":37,"length2":53}]],"length":4440,"saved":false}
{"ts":1362957503853,"patch":[[{"diffs":[[0,"        fn(err);"],[-1,"\n"],[0,"                "]],"start1":1285,"start2":1285,"length1":33,"length2":32},{"diffs":[[0,"    "],[-1,"                   break;"],[0,"\n   "]],"start1":1306,"start2":1306,"length1":33,"length2":8},{"diffs":[[0,"l,rooms[ctrin]);"],[-1,"\n"],[0,"                "]],"start1":1523,"start2":1523,"length1":33,"length2":32},{"diffs":[[0,"        "],[-1,"              break;"],[0,"\n       "]],"start1":1545,"start2":1545,"length1":36,"length2":16},{"diffs":[[0,"n]);"],[-1,"\n"],[0,"  "],[-1,"                              break;"],[0,"\n   "]],"start1":1934,"start2":1934,"length1":47,"length2":10}]],"length":4356,"saved":false}
{"ts":1362957532974,"patch":[[{"diffs":[[0,"              }\n"],[1,"                \n"],[0,"            }\n  "]],"start1":2168,"start2":2168,"length1":32,"length2":49}]],"length":4373,"saved":false}
